this.Handlebars=this.Handlebars||{},this.Handlebars.templates=this.Handlebars.templates||{},this.Handlebars.templates.Editor=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e,f,g="";return g+='\n            <li data-id="',(e=c.name)?d=e.call(a,{hash:{},data:b}):(e=a&&a.name,d=typeof e===k?e.call(a,{hash:{},data:b}):e),g+=l(d)+'">'+l((e=c.filename||a&&a.filename,f={hash:{},data:b},e?e.call(a,a&&a.name,f):m.call(a,"filename",a&&a.name,f)))+"</li>\n        "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h,i,j="",k="function",l=this.escapeExpression,m=c.helperMissing,n=this,o=c.blockHelperMissing;return j+="<div class='exercise-sidebar'>\n    <h1 class='name'>",(h=c.title)?g=h.call(b,{hash:{},data:e}):(h=b&&b.title,g=typeof h===k?h.call(b,{hash:{},data:e}):h),j+=l(g)+"</h1>\n    <ul class='tab-bar'>\n        ",i={hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e},(h=c.files)?g=h.call(b,i):(h=b&&b.files,g=typeof h===k?h.call(b,i):h),c.files||(g=o.call(b,g,{hash:{},inverse:n.noop,fn:n.program(1,f,e),data:e})),(g||0===g)&&(j+=g),j+="\n    </ul>\n\n    <section class='actions'>\n      <button class='run' type=\"button\"><i class=\"fa fa-play\"></i><span class='button-text'>K채ynnist채</span></button>\n      <button class='reset' type=\"button\"><i class=\"fa fa-undo\"></i><span class='button-text'>Nollaa</span></button>\n    </section>\n    <hr class=\"button-separator\">\n    <section class='actions'>\n      <button class='share' type=\"button\"><i class=\"fa fa-share-alt\"></i><span class='button-text'>Jaa</span></button>\n    </section>\n</div>\n"}),this.Handlebars.templates.Exercise=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<div class="exercise-area" id="exercise-',(g=c.id)?f=g.call(b,{hash:{},data:e}):(g=b&&b.id,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"\">\n  <div class=\"code-area tmc-exercise\" data-type='tmc-exercise' data-id='",(g=c.id)?f=g.call(b,{hash:{},data:e}):(g=b&&b.id,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'\'></div>\n  <iframe sandbox="allow-scripts" id="game-frame-',(g=c.id)?f=g.call(b,{hash:{},data:e}):(g=b&&b.id,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="game inactive">\n  </iframe>\n</div>\n'}),this.Handlebars.templates.Game=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+='<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="utf-8">\n  <title>sandbox</title>\n  <style type="text/css">\n    body {\n      margin: 0;\n    }\n    .game-area {\n      width: 800px;\n      height: 600px;\n    }\n  </style>\n</head>\n\n<body>\n\n<div class="game active" id="game-',(g=c.id)?f=g.call(b,{hash:{},data:e}):(g=b&&b.id,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'">\n  <a id="stop-game" href="#" title="stop-game" class="close">Pys채yt채</a>\n  <div id="game-area-',(g=c.id)?f=g.call(b,{hash:{},data:e}):(g=b&&b.id,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'" class="game-area"></div>\n</div>\n\n<script src="https://cdn.jsdelivr.net/phaser/2.4.4/phaser.js"></script>\n\n<script>\n  var _mainWindow = null;\n  console.info(\'Game frame loaded\');\n  //var _url = (window.location != window.parent.location) ? document.referrer: document.location;\n  var _url = \'*\';\n\n  var sendError = function(message) {\n    var msg = {\n      source: ',(g=c.id)?f=g.call(b,{hash:{},data:e}):(g=b&&b.id,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+",\n      error: message\n    }\n    if (_mainWindow) {\n      _mainWindow.postMessage(msg, _url);\n    } else {\n      console.warn(\"Unable to display a error message because I don't know who the main window is.\");\n    }\n  }\n\n  var _messageCount = 0;\n  window.addEventListener('message', function(e) {\n    if (_mainWindow === null) {\n      _mainWindow = e.source;\n    }\n    if (e.data == 'ready') {\n      var ready = typeof Phaser !== 'undefined';\n      if (_messageCount > 200) {\n        ready = true;\n      }\n      var msg = {\n        ready: ready,\n        source: ",(g=c.id)?f=g.call(b,{hash:{},data:e}):(g=b&&b.id,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"\n      }\n      e.source.postMessage(msg, _url);\n      _messageCount++;\n      return;\n    }\n    // A dirty workaround to mitigate a missing DOMContentLoaded event.\n    if (Phaser.Device._readyCheck) {\n      Phaser.Device._readyCheck();\n    }\n    var showMessage = function(message) {\n      var msg =  {\n        source: ",(g=c.id)?f=g.call(b,{hash:{},data:e}):(g=b&&b.id,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+",\n        message: message\n      }\n      e.source.postMessage(msg, _url);\n    }\n      try {\n        console.info('Evaluating code...');\n        eval(e.data);\n      } catch (error) {\n        sendError(error.toString());\n      }\n    });\n    document.getElementById('stop-game').addEventListener('click', function() {\n      var msg = {\n        source: ",(g=c.id)?f=g.call(b,{hash:{},data:e}):(g=b&&b.id,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+',\n        stop: true\n      }\n      if (_mainWindow) {\n        _mainWindow.postMessage(msg, _url);\n      } else {\n        console.warn("Unable to to close the dialog because I don\'t know who the main window is.");\n      }\n\n    });\n    window.onerror = function(errorMsg, url, lineNumber, column, errorObj) {\n      if (url === window.location.href) {\n        sendError(errorMsg)\n      }\n    }\n</script>\n</body>\n</html>\n'}),this.Handlebars.templates.Login=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+="<div class='tmc-exercise overlay'></div>\n\n<div class='tmc-exercise login'>\n\n    <h1>TMC</h1>\n\n    <p class='status'></p>\n\n	<form method='post'>\n\n        <div>\n            <label>Username</label>\n            <input class='username' name='username' required value='",(g=c.username)?f=g.call(b,{hash:{},data:e}):(g=b&&b.username,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+"'>\n        </div>\n\n        <div>\n            <label>Password</label>\n            <input class='password' name='password' type='password' required>\n        </div>\n\n        <button>Login</button>\n\n	</form>\n\n</div>\n"}),this.Handlebars.templates.OutputContainer=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c="";return c+="\n      <li>"+j(typeof a===i?a.apply(a):a)+"</li>\n    "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h="",i="function",j=this.escapeExpression,k=this;return h+="<section class='output-actions'>\n    <i class='fa fa-close close'></i>\n</section>\n<div class=\"output-content\">\n  <ul class=\"program-output\">\n    ",g=c.each.call(b,b&&b.lines,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(g||0===g)&&(h+=g),h+="\n  </ul>\n</div>\n"}),this.Handlebars.templates.OutputErrorContainer=Handlebars.template(function(a,b,c,d,e){function f(a,b){var c="";return c+="\n      <li>"+j(typeof a===i?a.apply(a):a)+"</li>\n    "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h="",i="function",j=this.escapeExpression,k=this;return h+="<section class='output-actions'>\n    <i class='fa fa-close close'></i>\n</section>\n<div class=\"output-content\">\n  <h1 class='title'>Korjaa koodistasi syntaksivirheet.</h1>\n\n  <ul>\n    ",g=c.each.call(b,b&&b.messages,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(g||0===g)&&(h+=g),h+="\n  </ul>\n</div>\n"}),this.Handlebars.templates.ShareOutputContainer=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i="function",j=this.escapeExpression;return h+="<section class='output-actions'>\n  <i class='fa fa-close close'></i>\n</section>\n\n<div class=\"output-content\">\n  <p>Linkki jaettuun koodiin:</p>\n  <input id=\"shared-code-url\" value=",(g=c.link_url)?f=g.call(b,{hash:{},data:e}):(g=b&&b.link_url,f=typeof g===i?g.call(b,{hash:{},data:e}):g),h+=j(f)+'>\n\n  <button class="copy-btn" data-clipboard-target="#shared-code-url">\n      Kopioi osoite\n  </button>\n</div>\n'});var TMCWebClient=function(){function a(){return $('[data-type="tmc-exercise"]')}function b(a){d(),a.each(function(a,b){var c=$(b).data("id"),d=Handlebars.templates.Exercise({id:c});$(b).replaceWith(d);var f=$("#exercise-"+c+" .tmc-exercise"),g=new e.exercise(c);g.fetch(function(){new e.editor(f,g)})})}function c(){$("body").find(".tmc-exercise-logout").first().click(TMCWebClient.session.logout)}function d(){var a=document.querySelector("body"),b=document.createElement("div");b.id="background-overlay",a.appendChild(b)}var e={server:"https://tmc.mooc.fi/staging",apiVersion:7};return e.initialise=function(){e.session.login(function(){b(a()),c()})},e.initializePaste=function(){d(),e.session.login(function(){var a=$("#tmc-paste"),b=window.location.search.split("=");if(2!==b.length)return void console.error("Unable to parse url parameters.");var d=b[1],f=new e.paste(d);f.fetch(function(){var b=f.getZip(),c=f.exercise;c.fetch(function(){c.setZip(b);var d=Handlebars.templates.Exercise({id:c.id});$(a).append(d).children(),a=$("#exercise-"+c.id+" .tmc-exercise");new e.editor(a,c)})}),c()})},e.getAuthenticationToken=function(){var a=e.session.getUsername(),b=e.session.getPassword();return btoa(encodeURIComponent(a)+":"+encodeURIComponent(b))},e.xhrBasicAuthentication=function(a){a.setRequestHeader("Authorization","Basic "+TMCWebClient.getAuthenticationToken())},e}();Handlebars.registerHelper("filename",function(a){return a.split("/").pop()}),Handlebars.registerHelper("percentage",function(a,b){return a/b*100}),Handlebars.registerHelper("pluralize",function(a,b){return 1===a?b:b+"s"}),TMCWebClient.editor=function(a,b){function c(a){a.setPrintMarginColumn(!1),a.setDisplayIndentGuides(!1),a.getSession().setFoldStyle("markbeginend"),a.setTheme("ace/theme/tomorrow"),a.setFontSize(13),a.getSession().setTabSize(4),a.getSession().setUseWrapMode(!0),a.getSession().setWrapLimitRange(90,90),a.getSession().setMode("ace/mode/javascript"),a.$blockScrolling=1/0}function d(a){P.forEach(function(a){E.getSession().removeFold(a)}),T.forEach(function(a){a.forEach(function(a){if(0!==a)try{P.push(E.session.addFold("",new I(a,0,a,900)))}catch(b){console.warn("Problems with adding folds")}})})}function e(a){Q.forEach(function(a){E.getSession().removeMarker(a)}),Q=[],R=[],T=M.getLockedRegions(a),T.forEach(function(a){var b=new I(a[0],0,a[1],900);Q.push(E.session.addMarker(b,"readonly-highlight","fullLine")),R.push(b)}),d(a)}function f(a){if(void 0!==G){var b=M.getFile(G).asText();if(void 0===O[G]){var c=TMCWebClient.snapshot.prototype.generatePatchData(G,"",b,!0);N.add(new TMCWebClient.snapshot(M,"insertText",c))}N.add(new TMCWebClient.snapshot(M,a.action,TMCWebClient.snapshot.prototype.generatePatchData(G,b,E.getValue(),!1))),O[G]=!0,A()}}function g(a,b,c){if(!c||O[a]===!0){O[a]&&(O[a]=!1);var d=M.getSrcZip({compression:"DEFLATE"}),e={cause:b,file:a},f=new TMCWebClient.snapshot(M,"code_snapshot",d,e);N.add(f)}}function h(){F=new TMCWebClient.output(K)}function i(){$(".actions .reset",K).click(function(){M.reset(),_files=M.getFilesFromSource(),G=_files[0].name;var a=M.getFile(G).asText();E.setValue(a),e(G),E.moveCursorTo(0,0),$(".tab-bar li",K).removeClass("active"),$(".tab-bar li",K).first().addClass("active")})}function j(){$(".actions .share",K).first().click(k)}function k(){var a=$(".actions .share i",K);a.parent().prop("disabled",!0);var b=a.parent().find(".button-text"),c=b.text();b.text("Jaetaan..."),a.addClass("fa-spin"),A(),g(G,"file_change",!0),M.share(function(d){var e=d.paste_url.split("/"),f=e[e.length-1],g="https://ohjelmointikurssi.github.io/paste/?key=",h=g+f;F.showShare(h),a.removeClass("fa-spin"),a.parent().prop("disabled",!1),b.text(c)},function(a){F.close(),console.log(a)});var d=TMCWebClient.snapshot.prototype.generateBase64Json({command:"tmc-web-client.share"});N.add(new TMCWebClient.snapshot(M,"project_action",d))}function l(){$(".actions .run",K).first().click(function(){var a=document.getElementById("game-frame-"+M.id);a.src="",setTimeout(m,100)}),window.addEventListener("message",function(a){a.data.source===M.id&&(a.data.ready===!0&&(console.info("Setting the game frame to be ready..."),W=!0),a.data.message&&(V.push(a.data.message),F.render(V)),a.data.error&&(o(),U.push(a.data.error),F.renderError(U)),a.data.stop&&o())})}function m(){V=[],U=[];var a=document.getElementById("game-frame-"+M.id),b="(function () { 'use strict'; }()); var console={log: function(a){showMessage(a)}};",c=Object.getOwnPropertyNames(M.getFiles()).filter(function(a){return a.endsWith(".js")&&!a.endsWith("test.js")}).sort().map(function(a){return M.getFiles()[a].asText()}).join("\n"),d=Object.getOwnPropertyNames(M.getFiles()).filter(function(a){return a.endsWith("update.js")});c=b+c,0!==d.length&&(c="game = new Phaser.Game(800, 600, Phaser.AUTO, 'game-area-' +"+M.id+", { preload: preload, create: create, update: update });"+c,$("#game-area-"+M.id).html(""),$("#game-frame-"+M.id).removeClass("inactive"),$("#background-overlay").addClass("active"),$("body").addClass("overlay-open")),c+="";var e=Handlebars.templates.Game({id:M.id,code:c});a.src="data:text/html;charset=utf-8,"+encodeURI(e),H=c,W=!1,n()}function n(){var a=document.getElementById("game-frame-"+M.id);W?(a.contentWindow.postMessage(H,"*"),console.info("Sent the code to be executed")):(console.info("Asking if the frame is ready."),a.contentWindow.postMessage("ready","*"),window.setTimeout(n,100))}function o(){$("#background-overlay").removeClass("active"),$("body").removeClass("overlay-open"),$("#game-frame-"+M.id).addClass("inactive");var a=document.getElementById("game-frame-"+M.id);a.src=""}function p(){$("#stop-game-"+M.id).click(function(a){a.preventDefault(),o()})}function q(){var a=window.onerror;window.onerror=function(b,c,d,e,f){return(c===window.location.href||f.showToUser)&&(F.render(b,Handlebars.templates.OutputErrorContainer),o()),a(b,c,d,e,f)}}function r(a){var b={title:M.getName(),files:a};$(K).prepend(J.editor(b)),D=$(".tab-bar",K).first(),L=$("li",D)[0].offsetLeft,$("li",D).click(w),j(),i(),l(),p(),q(),s()}function s(){E.on("input",function(){S&&e(G)}),E.keyBinding.addKeyboardHandler({handleKeyboard:function(a,b,c,d){return S&&e(G),-1===b||40>=d&&d>=37?!1:u()?{command:"null",passEvent:!1}:void((13===d||8===d||46===d)&&(S=!0))}}),t("onPaste"),t("onCut")}function t(a){var b=E[a];E[a]=function(){var a=Array.prototype.slice.call(arguments);if(!u())return b.apply(E,a)}}function u(){for(var a=E.getSelectionRange(),b=0;b<R.length;b++)if(a.intersects(R[b]))return!0;return!1}function v(a){$(K).show(),E.setValue(a),E.getSelection().clearSelection(),E.moveCursorTo(0,0),E.getSession().setScrollTop(0)}function w(){A(),g(G,"file_change",!0),B(),x($(this))}function x(a){$(".tab-bar li",K).removeClass("active"),a.addClass("active"),y(a);var b=a.attr("data-id"),c=M.getFile(b).asText();z(b),v(c),e(b),G=b}function y(a){D[0].scrollLeft=a[0].offsetLeft-L-D.width()/2+a.width()/2}function z(a){var b={c:"c_cpp",css:"css",h:"c_cpp",htm:"html",html:"html",java:"java",js:"javascript",json:"json",rb:"ruby",xml:"xml",yml:"yaml",py:"python"},c="text",d=M.getFileExtension(a);c=b[d]||c,E.getSession().setMode("ace/mode/"+c)}function A(){M.saveFile(G,E.getValue())}function B(){G=void 0,E.setValue("")}function C(){var a=$("<div/>");$(K).hide(),$(K).append(a),E=ace.edit(a.get(0)),c(E),M.fetchZip(function(){var a=M.getFilesFromSource();G=a[0].name;var b=M.getFile(G).asText();r(a),z(G),v(b),e(G),$(".tab-bar li",K).first().addClass("active"),E.on("change",f)}),h()}var D,E,F,G,H,I=ace.require("ace/range").Range,J={editor:Handlebars.templates.Editor},K=a,L=0,M=b,N=new TMCWebClient.spyware(b),O={},P=[],Q=[],R=[],S=!1,T=null,U=[],V=[],W=!1;C()},TMCWebClient.exercise=function(a){this.baseUrl=TMCWebClient.server+"/exercises/",this.id=a},TMCWebClient.exercise.prototype.fetch=function(a){if(void 0!==this.exercise)return void a();var b=this;$.ajax({beforeSend:TMCWebClient.xhrBasicAuthentication,data:{api_version:TMCWebClient.apiVersion},success:function(c){b.exercise=c,a()},url:this.baseUrl+this.id+".json"})},TMCWebClient.exercise.prototype.downloadZip=function(a,b){JSZipUtils.getBinaryContent(a,function(a,c){if(a)throw a;b(new JSZip(c))})},TMCWebClient.exercise.prototype.setZip=function(a){this.zip=a,this.getSourcePath(),this.storeOriginalZip(a)},TMCWebClient.exercise.prototype.fetchZip=function(a){if(this.zip)return void a();var b=this;this.downloadZip(this.baseUrl+this.id+".zip",function(c){b.zip=c,b.getSourcePath(),b.storeOriginalZip(c),a()})},TMCWebClient.exercise.prototype.storeOriginalZip=function(a){var b=new JSZip;a.file(/.*/).forEach(function(a){b.file(a.name,a.asText())}),this.originalZip=b},TMCWebClient.exercise.prototype.reset=function(){var a=new JSZip;this.originalZip.file(/.*/).forEach(function(b){a.file(b.name,b.asText())}),this.zip=a,this.sourcePath=null,this.getSourcePath()},TMCWebClient.exercise.prototype.submit=function(a,b){if(void 0!==this.zip){var c=new FormData;c.append("api_version",TMCWebClient.apiVersion),c.append("commit","Submit"),c.append("submission[file]",this.getZipBlob()),$.ajax({data:c,type:"POST",processData:!1,contentType:!1,url:this.baseUrl+this.id+"/submissions.json",beforeSend:TMCWebClient.xhrBasicAuthentication,success:a,error:b})}},TMCWebClient.exercise.prototype.share=function(a,b){if(void 0!==this.zip){var c=new FormData;c.append("api_version",TMCWebClient.apiVersion),c.append("commit","Submit"),c.append("submission[file]",this.getZipBlob()),$.ajax({data:c,type:"POST",processData:!1,contentType:!1,url:this.baseUrl+this.id+"/submissions.json?paste=1",beforeSend:TMCWebClient.xhrBasicAuthentication,success:a,error:b})}},TMCWebClient.exercise.prototype.fetchLastSubmission=function(a,b,c){if(void 0!==this.lastSubmission)return void a(this.lastSubmission);if(0===this.exercise.submissions.length)return void b();var d=this,e=this.exercise.submissions[0].id,f=TMCWebClient.server+"/submissions/"+e+".json?api_version="+TMCWebClient.apiVersion;$.ajax({url:f,beforeSend:TMCWebClient.xhrBasicAuthentication,success:function(b){return"processing"===b.status?void c(f):(d.lastSubmission=b,void a(d.lastSubmission))}})},TMCWebClient.exercise.prototype.getName=function(){var a=this.exercise.exercise_name;return a.substring(a.lastIndexOf(".")+1)},TMCWebClient.exercise.prototype.getExerciseName=function(){return this.exercise.exercise_name},TMCWebClient.exercise.prototype.getCourseName=function(){return this.exercise.course_name},TMCWebClient.exercise.prototype.getSourcePath=function(){if(this.sourcePath)return this.sourcePath;var a=this.getFilesFromSource()[0].name.split("/");return a.pop(),this.sourcePath=a.join("/")},TMCWebClient.exercise.prototype.getZipBlob=function(){return this.getZip({type:"blob"})},TMCWebClient.exercise.prototype.getZip=function(a){return this.zip.generate(a)},TMCWebClient.exercise.prototype.getSrcZip=function(a){var b=new JSZip;return this.getFilesFromSource().forEach(function(a){b.file(a.name,a.asText())}),b.generate(a)},TMCWebClient.exercise.prototype.getFiles=function(){return this.zip.files},TMCWebClient.exercise.prototype.getFile=function(a){return this.zip.file(a)},TMCWebClient.exercise.prototype.getFilesFromSource=function(){return this.zip.file(/src(?!\/\.).*/)},TMCWebClient.exercise.prototype.getFileExtension=function(a){var b=a.lastIndexOf("/");-1!==b&&(a=a.substring(b+1));var c=a.lastIndexOf(".");if(-1!==c&&0!==c){var d=a.substring(c+1);return d}},TMCWebClient.exercise.prototype.getLockedRegions=function(a){for(var b=[],c=this.zip.file(a).asText().split("\n"),d=0;d<c.length;d++){if(c[d].indexOf("// START LOCK")>-1)for(var e=d;e<c.length;e++)if(c[e].indexOf("// END LOCK")>-1){b.push([d,e]);break}c[d].indexOf("// LOCK FROM BEGINNING")>-1&&b.push([0,d]),c[d].indexOf("// LOCK TO END")>-1&&b.push([d,c.length-1])}return b},TMCWebClient.exercise.prototype.getFileLength=function(a){if(void 0===a)return console.warn("Filename is undefined"),-1;var b=this.zip.file(a).asText().split("\n");return b.length},TMCWebClient.exercise.prototype.saveFile=function(a,b){this.zip.file(a,b)},TMCWebClient.exercise.prototype.removeFile=function(a){this.zip.remove(a)},TMCWebClient.exercise.prototype.setLastSubmission=function(a){this.lastSubmission=a},TMCWebClient.output=function(a){this.template={output:Handlebars.templates.OutputContainer,error:Handlebars.templates.OutputErrorContainer},this.outputContainer=$("<div/>").addClass("tmc-output").addClass("hidden");var b=$("<div/>").addClass("tmc-output-wrapper");b.append(this.outputContainer),$(a).append(b)},TMCWebClient.output.prototype.render=function(a,b){this.clear();var c=this,d=b||this.template.output,e=$(d({lines:a}));e.find(".close").click(function(){c.close()}),this.outputContainer.append(e),this.outputContainer.removeClass("hidden")},TMCWebClient.output.prototype.renderError=function(a){this.clear();var b=this,c=Handlebars.templates.OutputErrorContainer,d=$(c({messages:a}));d.find(".close").click(function(){b.close()}),this.outputContainer.append(d),this.outputContainer.removeClass("hidden")},TMCWebClient.output.prototype.renderShare=function(a){this.clear();var b=this,c=Handlebars.templates.ShareOutputContainer,d=$(c({link_url:a}));d.find(".close").click(function(){b.close()}),new Clipboard(".copy-btn"),this.outputContainer.append(d),this.outputContainer.removeClass("hidden")},TMCWebClient.output.prototype.clear=function(){this.outputContainer.empty()},TMCWebClient.output.prototype.visible=function(){return this.outputContainer.is(":visible")},TMCWebClient.output.prototype.close=function(){this.outputContainer.addClass("hidden")},TMCWebClient.output.prototype.processing=function(){this.render()},TMCWebClient.output.prototype.showShare=function(a){this.renderShare(a)},TMCWebClient.output.prototype.showResults=function(a){if("error"===a.status)return this.showError(a);var b={status:a.status,passed:a.all_tests_passed,tests:a.test_cases,validations:this.getValidations(a.validations),ratio:this.calculateProgress(a.test_cases),submissionUrl:a.submission_url};this.render(b),this.createResultHandlers(b.ratio,b.validations)},TMCWebClient.output.prototype.showError=function(a){var b={error:a.error};this.render(b,this.template.error)},TMCWebClient.output.prototype.calculateProgress=function(a){var b=0,c=0;return a.forEach(function(a){a.successful?b++:c++}),{passed:b,failed:c,total:a.length}},TMCWebClient.output.prototype.getValidations=function(a){if(!a.validationErrors)return null;var b=a.validationErrors,c=0,d=[],e={results:d,errorCount:c};return this.buildValidations(e,b),e},TMCWebClient.output.prototype.buildValidations=function(a,b){for(var c in b){var d={};d.name=c,d.messages=[];var e=b[c];for(var f in e)e.hasOwnProperty(f)&&d.messages.push(e[f]);a.errorCount+=d.messages.length,a.results.push(d)}},TMCWebClient.output.prototype.createResultHandlers=function(a,b){0!==a.failed&&this.createTestResultsHandler(),0!==b.errorCount&&this.createValidationResultsHandler()},TMCWebClient.output.prototype.createTestResultsHandler=function(){var a=this,b=this.outputContainer.find(".results .test-results");b.addClass("active"),b.click(function(){a.detailedTestResultsOnClickHandler()})},TMCWebClient.output.prototype.detailedTestResultsOnClickHandler=function(){this.outputContainer.find(".results .validation-results").toggle(),this.outputContainer.find(".results .test-results").toggleClass("extended"),this.outputContainer.find(".results .test-results .details").toggle()},TMCWebClient.output.prototype.createValidationResultsHandler=function(){var a=this,b=this.outputContainer.find(".results .validation-results");b.addClass("active"),b.click(function(){a.detailedValidationResultsOnClickHandler()})},TMCWebClient.output.prototype.detailedValidationResultsOnClickHandler=function(){this.outputContainer.find(".results .test-results").toggle(),this.outputContainer.find(".results .validation-results").toggleClass("extended"),this.outputContainer.find(".results .validation-results .details").toggle()},TMCWebClient.paste=function(a){this.baseUrl=TMCWebClient.server+"/paste/",this.id=a},TMCWebClient.paste.prototype.fetch=function(a){if(void 0!==this.exercise)return void a();var b=this;$.ajax({beforeSend:TMCWebClient.xhrBasicAuthentication,data:{api_version:TMCWebClient.apiVersion,include_files:1},success:function(c){b.data=c;var d=c.solution_url.split("/"),e=parseInt(d[d.length-2]);b.exercise=new TMCWebClient.exercise(e),b.exercise.fetch(function(){a()})},error:function(){console.error("Could not download paste")},url:this.baseUrl+this.id+".json"})},TMCWebClient.paste.prototype.getZip=function(){var a=new JSZip;return this.data.files.forEach(function(b){a.file(b.path,b.contents)}),a},TMCWebClient.session=function(){var a={login:Handlebars.templates.Login},b={username:localStorage.username,password:localStorage.password};return b.logout=function(){localStorage.removeItem("username"),localStorage.removeItem("password"),b.username=void 0,b.password=void 0,b.login($.noop)},b.login=function(c){if(void 0!==b.username&&void 0!==b.password)return void c();var d=$(a.login({username:b.username})),e=$(".status",d);$("form",d).submit(function(){var a=$("form",d).serialize(),f=$(".username",d).val(),g=$(".password",d).val();return e.text(""),$.post(TMCWebClient.server+"/auth.text",a,function(a){"OK"===a?(d.remove(),b.username=localStorage.username=f,b.password=localStorage.password=g,c()):e.text("Wrong username or password!")}),!1}),$("body").append(d)},b.getUsername=function(){return b.username},b.getPassword=function(){return b.password},b}(),TMCWebClient.snapshot=function(a,b,c,d){this.courseName=a.getCourseName(),this.exerciseName=a.getExerciseName(),this.eventType=this.getEventType(b),this.data=c,void 0!==d&&(this.metadata=JSON.stringify(d)),this.happenedAt=Date.now(),this.systemNanotime=Math.round(window.performance.now())},TMCWebClient.snapshot.prototype.getEventType=function(a){var b={insertText:"text_insert",insertLines:"text_insert",removeText:"text_remove",removeLines:"text_remove"};return b[a]||a},TMCWebClient.snapshot.prototype.generatePatchData=function(a,b,c,d){return this.generateBase64Json({file:a,patches:this.generatePatch(b,c),full_document:d})},TMCWebClient.snapshot.prototype.generateBase64Json=function(a){return btoa(JSON.stringify(a))},TMCWebClient.snapshot.prototype.generatePatch=function(a,b){var c=new diff_match_patch,d=c.diff_main(a,b,!0);d.length>2&&c.diff_cleanupSemantic(d);var e=c.patch_make(a,b,d);return c.patch_toText(e)},TMCWebClient.spyware=function(a){this._exercise=a,this._snapshots=[],this.timedSubmit(18e4)},TMCWebClient.spyware.prototype.add=function(a){this._snapshots.push(a)},TMCWebClient.spyware.prototype.submit=function(){var a=this._snapshots;this._snapshots=[],0!==a.length&&$.post("http://gzip.josalmi.fi/",{url:"http://staging.spyware.testmycode.net",data:JSON.stringify(a),username:TMCWebClient.session.getUsername(),password:TMCWebClient.session.getPassword()})},TMCWebClient.spyware.prototype.timedSubmit=function(a){setInterval(this.submit.bind(this),a)};